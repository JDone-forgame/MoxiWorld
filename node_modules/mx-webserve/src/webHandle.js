"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebHandle = void 0;
const path_1 = require("path");
function parseErrorLine(err) {
    if (!err || !(err instanceof Error) || !err.stack) {
        return '[-]';
    }
    const stack = err.stack;
    const stackArr = stack.split('\n');
    let callerLogIndex = (stackArr.length > 0) ? 1 : 0;
    // for (let i = 0; i < stackArr.length; i++) {
    //     if (stackArr[i].indexOf('makeError') > 0 && i + 1 < stackArr.length) {
    //         callerLogIndex = i + 1;
    //         break;
    //     }
    // }
    if (callerLogIndex !== 0) {
        const callerStackLine = stackArr[callerLogIndex];
        let list = callerStackLine.split(/\(|\)/);
        if (list[1] && list[1].length > 0) {
            return `[${list[1].replace(process.cwd(), '').replace(/\\/g, "/").replace('/', '')}]`;
        }
        else {
            return `[${callerStackLine.substring(callerStackLine.lastIndexOf(path_1.sep) + 1, callerStackLine.lastIndexOf(':'))}]`;
        }
    }
    else {
        return '[-]';
    }
}
class HandleUnit {
    constructor(symbol) {
        this.routeMap = {};
        this.beforeList = [];
        this.afterList = [];
        this.symbol = symbol || Symbol();
    }
    paramsCheck(checkMap, params) {
        if (checkMap == undefined)
            return;
        for (let key in checkMap) {
            let cfg = checkMap[key];
            if (cfg.required && !params.hasOwnProperty(key)) {
                // 这里没找到 抛出一个异常
                throw Error(`param [${key} required and type limit ${cfg.type}]`);
            }
            else if (!params.hasOwnProperty(key)) {
                continue;
            }
            if (cfg.type == typeof params[key]) {
                continue;
            }
            // 这里类型不同
            if (!cfg.change) {
                throw Error(`param [${key} type limit ${cfg.type}]`);
            }
            else {
                switch (cfg.type) {
                    case "bigint":
                        params[key] = BigInt(params[key]);
                        break;
                    case "boolean":
                        params[key] = Boolean(params[key]);
                        break;
                    case "function": throw Error(`param [${key} type limit ${cfg.type}]`);
                    case "number":
                        params[key] = Number(params[key]);
                        // 这里增加一个小优化 ，如果是整数那么直接转换成整数
                        if (params[key] = parseInt(params[key])) {
                            params[key] = parseInt(params[key]);
                        }
                        break;
                    case "object":
                        params[key] = JSON.parse(params[key].toString());
                        break;
                    case "string":
                        params[key] = String(params[key]);
                        break;
                    case "symbol":
                        params[key] = Symbol(params[key]);
                        break;
                    default: break;
                }
            }
        }
    }
    /**
     * 调用模块
     * @param pathlist
     * @param req
     * @param res
     * @param next
     */
    route(Name, req, res, next) {
        return __awaiter(this, void 0, void 0, function* () {
            let routeMap = this.routeMap[Name];
            if (!routeMap) {
                req.responseData = {
                    code: -1,
                    errMsg: "can not find [" + req.path + "]"
                };
                return true;
            }
            try {
                this.paramsCheck(routeMap.params, req.params);
                // 这里开始调用响应
                req.responseData = yield routeMap.value.apply(routeMap.target, [req.params, req.method.toUpperCase(), req.headers, req]);
                if (req.responseData == undefined) {
                    req.responseData = { code: 0 };
                }
            }
            catch (e) {
                if (!e) {
                    req.responseData = {
                        code: -1,
                        errMsg: "error bug no message"
                    };
                }
                else if (typeof e == 'string') {
                    req.responseData = e;
                }
                else if (e instanceof Error) {
                    req.responseData = {
                        code: -1,
                        errMsg: e.message,
                        __line__: parseErrorLine(e)
                    };
                }
                else {
                    req.responseData = e;
                }
            }
            return true;
        });
    }
    /**
    * 调用模块
    * @param pathlist
    * @param req
    * @param res
    * @param next
    */
    before(req, res) {
        return __awaiter(this, void 0, void 0, function* () {
            for (let i = 0; i < this.beforeList.length; i++) {
                let routeMap = this.beforeList[i];
                try {
                    this.paramsCheck(routeMap.params, req.params);
                    yield routeMap.value.apply(routeMap.target, [req, res]);
                }
                catch (e) {
                    // 出钱异常的化
                    if (!e) {
                        req.responseData = {
                            code: -1,
                            errMsg: "error bug no message"
                        };
                    }
                    else if (typeof e == 'string') {
                        req.responseData = e;
                    }
                    else if (e instanceof Error) {
                        req.responseData = {
                            code: -1,
                            errMsg: e.message,
                            __line__: parseErrorLine(e)
                        };
                    }
                    else {
                        req.responseData = e;
                    }
                    return false;
                }
            }
            return true;
        });
    }
    /**
    * 调用模块
    * @param pathlist
    * @param req
    * @param res
    * @param next
    */
    after(req, res) {
        return __awaiter(this, void 0, void 0, function* () {
            for (let i = 0; i < this.afterList.length; i++) {
                let routeMap = this.afterList[i];
                try {
                    this.paramsCheck(routeMap.params, req.params);
                    yield routeMap.value.apply(routeMap.target, [req, res]);
                }
                catch (e) {
                    // 出钱异常的化
                    if (!e) {
                        req.responseData = {
                            code: -1,
                            errMsg: "error bug no message"
                        };
                    }
                    else if (typeof e == 'string') {
                        req.responseData = e;
                    }
                    else if (e instanceof Error) {
                        req.responseData = {
                            code: -1,
                            errMsg: e.message,
                            __line__: parseErrorLine(e)
                        };
                    }
                    else {
                        req.responseData = e;
                    }
                    return false;
                }
            }
            return true;
        });
    }
}
class HandleMap {
    constructor(type) {
        this.routeMap = {};
        this.type = type;
    }
    mergeModule(fileRoute) {
        // this.routeMap[prePath].routeMap = Object.assign(this.routeMap[prePath].routeMap, this.currNode.routeMap)
        // if (this.currNode.afterList) this.routeMap[prePath].afterList.push(...this.currNode.afterList)
        // if (this.currNode.beforeList) this.routeMap[prePath].beforeList.push(...this.currNode.beforeList)
        for (let key in this.routeMap) {
            let file = key;
            let mmap = this.routeMap[key];
            // 判断一下是全路径的还是相对地址的
            if (file.indexOf(fileRoute) < 0)
                continue;
            // 这里改成相对地址的模块
            let nKey = key.replace(fileRoute, "/");
            let n = this.getModule(nKey);
            n.routeMap = Object.assign(mmap.routeMap, n.routeMap);
            if (mmap.afterList)
                n.afterList.push(...mmap.afterList);
            if (mmap.beforeList)
                n.beforeList.push(...mmap.beforeList);
            delete this.routeMap[key];
        }
        this.mainPath = fileRoute;
    }
    hasModule(prePath) {
        if (this.routeMap[prePath])
            true;
        return false;
    }
    formateRoute(prePath) {
        prePath = prePath.replace(/\\/g, "/");
        if (this.mainPath) {
            prePath = prePath.replace(this.mainPath, "/");
        }
        prePath = prePath.replace(/\/\//g, "/");
        if (prePath == undefined || prePath == null || prePath == "")
            prePath = "/";
        if (prePath[0] != "/")
            prePath = "/" + prePath;
        // if (prePath.charAt(0) != "/") prePath = "/" + prePath;
        return prePath;
    }
    getModule(prePath) {
        prePath = this.formateRoute(prePath);
        if (!this.routeMap[prePath])
            this.routeMap[prePath] = new HandleUnit();
        return this.routeMap[prePath];
    }
    _chechMethod(target) {
        if (!this.currNode)
            this.currNode = new HandleUnit();
        if (!target.___symbol)
            target.___symbol = this.currNode.symbol;
        if (target.___symbol != this.currNode.symbol) {
            // 表示注册的不是当前class的模块了，需要替换
            this.currNode = new HandleUnit;
        }
    }
    /**
     * 设置模块的归属
     */
    class(prePath) {
        return (target) => {
            if (prePath == undefined)
                prePath = target.name;
            if (typeof prePath != "string") {
                let pd = path_1.parse(prePath.filename);
                if (pd.name == "index") {
                    prePath = pd.dir;
                }
                else {
                    prePath = path_1.join(pd.dir, pd.name);
                }
            }
            prePath = this.formateRoute(prePath);
            if (!this.currNode)
                return;
            // 这里负责把当前注册的节点添加到目标节点库中
            if (this.routeMap[prePath]) {
                // 这里需要合并
                this.routeMap[prePath].routeMap = Object.assign(this.routeMap[prePath].routeMap, this.currNode.routeMap);
                if (this.currNode.afterList)
                    this.routeMap[prePath].afterList.push(...this.currNode.afterList);
                if (this.currNode.beforeList)
                    this.routeMap[prePath].beforeList.push(...this.currNode.beforeList);
                this.currNode = undefined;
            }
            else {
                this.routeMap[prePath] = this.currNode;
                this.currNode = undefined;
            }
        };
    }
    methodPrepare(descriptor) {
        if (!descriptor.params)
            descriptor.params = {};
    }
    /**
    * 注册路由
    */
    route(Name) {
        return (target, name, descriptor) => {
            this._chechMethod(target);
            this.methodPrepare(descriptor);
            if (Name == undefined && typeof name == "string")
                Name = name;
            if (Name == undefined || descriptor.value == undefined)
                return;
            if (this.currNode)
                this.currNode.routeMap[Name] = {
                    target: target,
                    value: descriptor.value,
                    params: descriptor.params
                };
        };
    }
    /**
    * 检查路由参数 如果调用了那么就给这个函数增加一个参数检查的标识，否则就不处理
    */
    params(pName, pType, required, change) {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (!this.currNode || !descriptor.params) {
                // 理论上不会进入这里的
                return;
            }
            if (typeof name == "string") {
                descriptor.params[pName] = { type: pType, required: required, change: change };
            }
            else {
                // 这里如果传入的是 symbol 那么就比较难受了
                console.warn(`params check error on func ${name.toString()} ${pName} ${pType}`);
            }
        };
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (descriptor.value && this.currNode)
                this.currNode.beforeList.push({
                    target: target,
                    params: descriptor.params || {},
                    value: descriptor.value
                });
        };
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return (target, name, descriptor) => {
            this.methodPrepare(descriptor);
            this._chechMethod(target);
            if (descriptor.value && this.currNode)
                this.currNode.afterList.push({
                    target: target,
                    params: descriptor.params || {},
                    value: descriptor.value
                });
        };
    }
}
class WebHandle {
    constructor() {
        this.mainPath = "";
        this.globalMap = new HandleMap("global");
        this.envMap = new HandleMap("env");
        this.routeMap = new HandleMap("route");
        // 当前的环境
        this._env = "";
    }
    init(mainPath, env) {
        this.mainPath = mainPath.replace(/\\/g, "/");
        this.setEnv(env || "");
        // 合并一下啊各种模块
        this.routeMap.mergeModule(this.mainPath);
    }
    /**
    * 设置模块的归属
    */
    class(prePath) {
        return this.routeMap.class(prePath);
    }
    /**
     * 注册路由
     */
    route(Name) {
        return this.routeMap.route(Name);
    }
    /**
     * 注册参数检查
     */
    params(Name, type, required, change) {
        return this.routeMap.params(Name, type, required, change);
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return this.routeMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return this.routeMap.after();
    }
    /**
     * 获取一个响应模块
     * @param prePath 可以设置相对路径字符串，或者模块对象
     */
    getModule(prePath) {
        if (typeof prePath != "string") {
            prePath = prePath.filename;
        }
        return this.routeMap.getModule(prePath);
    }
    getEnvModule() {
        return this.envMap.getModule(this.getEnv());
    }
    getGlobalModule() {
        return this.globalMap.getModule("");
    }
    /**
     * 设置当前环境 （主要是提供给处理方法调用环境判断）
     * @param env 环境参数
     */
    setEnv(env) {
        this._env = env;
    }
    /**
     * 获取当前环境
     */
    getEnv() {
        if (typeof this._env == "function") {
            return this._env();
        }
        else {
            return this._env;
        }
    }
    /**
     * 设置模块的归属
     */
    envClass(prePath) {
        return this.envMap.class(prePath);
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    envBefore() {
        return this.envMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    envAfter() {
        return this.envMap.after();
    }
    /**
     * 全局模块
     */
    globalClass() {
        return this.globalMap.class("");
    }
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    globalBefore() {
        return this.globalMap.before();
    }
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    globalAfter() {
        return this.globalMap.after();
    }
}
exports.WebHandle = WebHandle;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViSGFuZGxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2ViSGFuZGxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBLCtCQUF3QztBQUd4QyxTQUFTLGNBQWMsQ0FBQyxHQUFVO0lBQzlCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsWUFBWSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUU7UUFDL0MsT0FBTyxLQUFLLENBQUE7S0FDZjtJQUVELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7SUFDeEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxJQUFJLGNBQWMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25ELDhDQUE4QztJQUM5Qyw2RUFBNkU7SUFDN0Usa0NBQWtDO0lBQ2xDLGlCQUFpQjtJQUNqQixRQUFRO0lBQ1IsSUFBSTtJQUVKLElBQUksY0FBYyxLQUFLLENBQUMsRUFBRTtRQUN0QixNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFXLENBQUM7UUFDM0QsSUFBSSxJQUFJLEdBQUcsZUFBZSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN6QyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMvQixPQUFPLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FB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QUFDO0lBRUQ7O09BRUc7SUFDSCxRQUFRO1FBQ0osT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVc7UUFDUCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILFlBQVk7UUFDUixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNQLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0NBQ0o7QUFwSUQsOEJBb0lDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEZ1bmN0aW9uLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XHJcbmltcG9ydCB7IEluY29taW5nSHR0cEhlYWRlcnMgfSBmcm9tIFwiaHR0cFwiO1xyXG5pbXBvcnQgeyBqb2luLCBwYXJzZSwgc2VwIH0gZnJvbSBcInBhdGhcIjtcclxuXHJcblxyXG5mdW5jdGlvbiBwYXJzZUVycm9yTGluZShlcnI6IEVycm9yKSB7XHJcbiAgICBpZiAoIWVyciB8fCAhKGVyciBpbnN0YW5jZW9mIEVycm9yKSB8fCAhZXJyLnN0YWNrKSB7XHJcbiAgICAgICAgcmV0dXJuICdbLV0nXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhY2sgPSBlcnIuc3RhY2s7XHJcbiAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKTtcclxuICAgIGxldCBjYWxsZXJMb2dJbmRleCA9IChzdGFja0Fyci5sZW5ndGggPiAwKSA/IDEgOiAwO1xyXG4gICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCBzdGFja0Fyci5sZW5ndGg7IGkrKykge1xyXG4gICAgLy8gICAgIGlmIChzdGFja0FycltpXS5pbmRleE9mKCdtYWtlRXJyb3InKSA+IDAgJiYgaSArIDEgPCBzdGFja0Fyci5sZW5ndGgpIHtcclxuICAgIC8vICAgICAgICAgY2FsbGVyTG9nSW5kZXggPSBpICsgMTtcclxuICAgIC8vICAgICAgICAgYnJlYWs7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG5cclxuICAgIGlmIChjYWxsZXJMb2dJbmRleCAhPT0gMCkge1xyXG4gICAgICAgIGNvbnN0IGNhbGxlclN0YWNrTGluZSA9IHN0YWNrQXJyW2NhbGxlckxvZ0luZGV4XSBhcyBzdHJpbmc7XHJcbiAgICAgICAgbGV0IGxpc3QgPSBjYWxsZXJTdGFja0xpbmUuc3BsaXQoL1xcKHxcXCkvKVxyXG4gICAgICAgIGlmIChsaXN0WzFdICYmIGxpc3RbMV0ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYFske2xpc3RbMV0ucmVwbGFjZShwcm9jZXNzLmN3ZCgpLCAnJykucmVwbGFjZSgvXFxcXC9nLCBcIi9cIikucmVwbGFjZSgnLycsICcnKX1dYFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGBbJHtjYWxsZXJTdGFja0xpbmUuc3Vic3RyaW5nKGNhbGxlclN0YWNrTGluZS5sYXN0SW5kZXhPZihzZXApICsgMSwgY2FsbGVyU3RhY2tMaW5lLmxhc3RJbmRleE9mKCc6JykpfV1gO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuICdbLV0nO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFJlcXVlc3RFeCBleHRlbmRzIFJlcXVlc3Qge1xyXG4gICAgcmVzcG9uc2VEYXRhOiBhbnlcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgU2VQYXJhbUNvbmZpZ1R5cGUgPSBcImJpZ2ludFwiIHwgXCJib29sZWFuXCIgfCBcImZ1bmN0aW9uXCIgfCBcIm51bWJlclwiIHwgXCJvYmplY3RcIiB8IFwic3RyaW5nXCIgfCBcInN5bWJvbFwiXHJcblxyXG5pbnRlcmZhY2UgaWZQYXJhbUNoZWNrQ29uZmlnIHsgW25hbWU6IHN0cmluZ106IHsgdHlwZTogU2VQYXJhbUNvbmZpZ1R5cGUsIHJlcXVpcmVkOiBib29sZWFuLCBjaGFuZ2U6IGJvb2xlYW4gfSB9XHJcbmludGVyZmFjZSBUeXBlZFByb3BlcnR5RGVzY3JpcHRvckV4PFQ+IGV4dGVuZHMgVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3I8VD4ge1xyXG4gICAgcGFyYW1zPzogaWZQYXJhbUNoZWNrQ29uZmlnXHJcbn1cclxuXHJcblxyXG5jbGFzcyBIYW5kbGVVbml0IHtcclxuICAgIHN5bWJvbDogc3ltYm9sXHJcbiAgICBjb25zdHJ1Y3RvcihzeW1ib2w/OiBzeW1ib2wpIHtcclxuICAgICAgICB0aGlzLnN5bWJvbCA9IHN5bWJvbCB8fCBTeW1ib2woKVxyXG4gICAgfVxyXG5cclxuICAgIHJvdXRlTWFwOiB7XHJcbiAgICAgICAgW2Y6IHN0cmluZ106IHtcclxuICAgICAgICAgICAgdGFyZ2V0OiBhbnk7XHJcbiAgICAgICAgICAgIHZhbHVlOiAocGFyYW06IHsgW3g6IHN0cmluZ106IGFueSB9LCBtZXRob2Q6IHN0cmluZywgaGVhZGVyczogSW5jb21pbmdIdHRwSGVhZGVycywgcmVxPzogUmVxdWVzdEV4KSA9PiBQcm9taXNlPGFueT47XHJcbiAgICAgICAgICAgIHBhcmFtczogaWZQYXJhbUNoZWNrQ29uZmlnXHJcbiAgICAgICAgfVxyXG4gICAgfSA9IHt9O1xyXG4gICAgYmVmb3JlTGlzdDoge1xyXG4gICAgICAgIHRhcmdldDogYW55O1xyXG4gICAgICAgIHBhcmFtczogaWZQYXJhbUNoZWNrQ29uZmlnLFxyXG4gICAgICAgIHZhbHVlOiAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiBhbnlcclxuICAgIH1bXSA9IFtdXHJcbiAgICBhZnRlckxpc3Q6IHtcclxuICAgICAgICB0YXJnZXQ6IGFueTtcclxuICAgICAgICB2YWx1ZTogKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4gYW55XHJcbiAgICAgICAgcGFyYW1zOiBpZlBhcmFtQ2hlY2tDb25maWcsXHJcbiAgICB9W10gPSBbXVxyXG5cclxuXHJcbiAgICBwYXJhbXNDaGVjayhjaGVja01hcDogaWZQYXJhbUNoZWNrQ29uZmlnLCBwYXJhbXM6IHsgW3g6IHN0cmluZ106IGFueSB9KSB7XHJcbiAgICAgICAgaWYgKGNoZWNrTWFwID09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gY2hlY2tNYXApIHtcclxuICAgICAgICAgICAgbGV0IGNmZyA9IGNoZWNrTWFwW2tleV07XHJcbiAgICAgICAgICAgIGlmIChjZmcucmVxdWlyZWQgJiYgIXBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDov5nph4zmsqHmib7liLAg5oqb5Ye65LiA5Liq5byC5bi4XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgcGFyYW0gWyR7a2V5fSByZXF1aXJlZCBhbmQgdHlwZSBsaW1pdCAke2NmZy50eXBlfV1gKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFwYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjZmcudHlwZSA9PSB0eXBlb2YgcGFyYW1zW2tleV0pIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIOi/memHjOexu+Wei+S4jeWQjFxyXG4gICAgICAgICAgICBpZiAoIWNmZy5jaGFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBwYXJhbSBbJHtrZXl9IHR5cGUgbGltaXQgJHtjZmcudHlwZX1dYClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY2ZnLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHBhcmFtc1trZXldID0gQmlnSW50KHBhcmFtc1trZXldKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImJvb2xlYW5cIjogcGFyYW1zW2tleV0gPSBCb29sZWFuKHBhcmFtc1trZXldKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6IHRocm93IEVycm9yKGBwYXJhbSBbJHtrZXl9IHR5cGUgbGltaXQgJHtjZmcudHlwZX1dYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIm51bWJlclwiOiBwYXJhbXNba2V5XSA9IE51bWJlcihwYXJhbXNba2V5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOi/memHjOWinuWKoOS4gOS4quWwj+S8mOWMliDvvIzlpoLmnpzmmK/mlbTmlbDpgqPkuYjnm7TmjqXovazmjaLmiJDmlbTmlbBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtc1trZXldID0gcGFyc2VJbnQocGFyYW1zW2tleV0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IHBhcnNlSW50KHBhcmFtc1trZXldKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJvYmplY3RcIjogcGFyYW1zW2tleV0gPSBKU09OLnBhcnNlKHBhcmFtc1trZXldLnRvU3RyaW5nKCkpOyBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6IHBhcmFtc1trZXldID0gU3RyaW5nKHBhcmFtc1trZXldKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInN5bWJvbFwiOiBwYXJhbXNba2V5XSA9IFN5bWJvbChwYXJhbXNba2V5XSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiwg+eUqOaooeWdl1xyXG4gICAgICogQHBhcmFtIHBhdGhsaXN0IFxyXG4gICAgICogQHBhcmFtIHJlcSBcclxuICAgICAqIEBwYXJhbSByZXMgXHJcbiAgICAgKiBAcGFyYW0gbmV4dCBcclxuICAgICAqL1xyXG4gICAgYXN5bmMgcm91dGUoTmFtZTogc3RyaW5nLCByZXE6IFJlcXVlc3RFeCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgbGV0IHJvdXRlTWFwID0gdGhpcy5yb3V0ZU1hcFtOYW1lXVxyXG4gICAgICAgIGlmICghcm91dGVNYXApIHtcclxuICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgZXJyTXNnOiBcImNhbiBub3QgZmluZCBbXCIgKyByZXEucGF0aCArIFwiXVwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFyYW1zQ2hlY2socm91dGVNYXAucGFyYW1zLCByZXEucGFyYW1zKVxyXG4gICAgICAgICAgICAvLyDov5nph4zlvIDlp4vosIPnlKjlk43lupRcclxuICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGF3YWl0IHJvdXRlTWFwLnZhbHVlLmFwcGx5KHJvdXRlTWFwLnRhcmdldCwgW3JlcS5wYXJhbXMsIHJlcS5tZXRob2QudG9VcHBlckNhc2UoKSwgcmVxLmhlYWRlcnMsIHJlcV0pXHJcbiAgICAgICAgICAgIGlmIChyZXEucmVzcG9uc2VEYXRhID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IHsgY29kZTogMCB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlKSB7XHJcbiAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIGVyck1zZzogXCJlcnJvciBidWcgbm8gbWVzc2FnZVwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGUgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgIGVyck1zZzogZS5tZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIF9fbGluZV9fOiBwYXJzZUVycm9yTGluZShlKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICog6LCD55So5qih5Z2XXHJcbiAgICAqIEBwYXJhbSBwYXRobGlzdCBcclxuICAgICogQHBhcmFtIHJlcSBcclxuICAgICogQHBhcmFtIHJlcyBcclxuICAgICogQHBhcmFtIG5leHQgXHJcbiAgICAqL1xyXG4gICAgYXN5bmMgYmVmb3JlKHJlcTogUmVxdWVzdEV4LCByZXM6IFJlc3BvbnNlKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmJlZm9yZUxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlTWFwID0gdGhpcy5iZWZvcmVMaXN0W2ldO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJhbXNDaGVjayhyb3V0ZU1hcC5wYXJhbXMsIHJlcS5wYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgcm91dGVNYXAudmFsdWUuYXBwbHkocm91dGVNYXAudGFyZ2V0LCBbcmVxLCByZXNdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8g5Ye66ZKx5byC5bi455qE5YyWXHJcbiAgICAgICAgICAgICAgICBpZiAoIWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBcImVycm9yIGJ1ZyBubyBtZXNzYWdlXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXEucmVzcG9uc2VEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAtMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyTXNnOiBlLm1lc3NhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fbGluZV9fOiBwYXJzZUVycm9yTGluZShlKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgKiDosIPnlKjmqKHlnZdcclxuICAgICogQHBhcmFtIHBhdGhsaXN0IFxyXG4gICAgKiBAcGFyYW0gcmVxIFxyXG4gICAgKiBAcGFyYW0gcmVzIFxyXG4gICAgKiBAcGFyYW0gbmV4dCBcclxuICAgICovXHJcbiAgICBhc3luYyBhZnRlcihyZXE6IFJlcXVlc3RFeCwgcmVzOiBSZXNwb25zZSkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hZnRlckxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlTWFwID0gdGhpcy5hZnRlckxpc3RbaV07XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmFtc0NoZWNrKHJvdXRlTWFwLnBhcmFtcywgcmVxLnBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1hcC52YWx1ZS5hcHBseShyb3V0ZU1hcC50YXJnZXQsIFtyZXEsIHJlc10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlh7rpkrHlvILluLjnmoTljJZcclxuICAgICAgICAgICAgICAgIGlmICghZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJNc2c6IFwiZXJyb3IgYnVnIG5vIG1lc3NhZ2VcIlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBlID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcS5yZXNwb25zZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IC0xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJNc2c6IGUubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgX19saW5lX186IHBhcnNlRXJyb3JMaW5lKGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxLnJlc3BvbnNlRGF0YSA9IGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBIYW5kbGVNYXAge1xyXG4gICAgcHJpdmF0ZSByb3V0ZU1hcDogeyBbZjogc3RyaW5nXTogSGFuZGxlVW5pdCB9ID0ge307XHJcbiAgICBwcml2YXRlIGN1cnJOb2RlOiBIYW5kbGVVbml0IHwgdW5kZWZpbmVkO1xyXG4gICAgcHJpdmF0ZSB0eXBlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIG1haW5QYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBcInJvdXRlXCIgfCBcImVudlwiIHwgXCJnbG9iYWxcIikge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICB9XHJcblxyXG4gICAgbWVyZ2VNb2R1bGUoZmlsZVJvdXRlOiBzdHJpbmcpIHtcclxuICAgICAgICAvLyB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLnJvdXRlTWFwID0gT2JqZWN0LmFzc2lnbih0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLnJvdXRlTWFwLCB0aGlzLmN1cnJOb2RlLnJvdXRlTWFwKVxyXG4gICAgICAgIC8vIGlmICh0aGlzLmN1cnJOb2RlLmFmdGVyTGlzdCkgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXS5hZnRlckxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmFmdGVyTGlzdClcclxuICAgICAgICAvLyBpZiAodGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0KSB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLmJlZm9yZUxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmJlZm9yZUxpc3QpXHJcblxyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiB0aGlzLnJvdXRlTWFwKSB7XHJcbiAgICAgICAgICAgIGxldCBmaWxlID0ga2V5O1xyXG4gICAgICAgICAgICBsZXQgbW1hcCA9IHRoaXMucm91dGVNYXBba2V5XVxyXG4gICAgICAgICAgICAvLyDliKTmlq3kuIDkuIvmmK/lhajot6/lvoTnmoTov5jmmK/nm7jlr7nlnLDlnYDnmoRcclxuICAgICAgICAgICAgaWYgKGZpbGUuaW5kZXhPZihmaWxlUm91dGUpIDwgMCkgY29udGludWVcclxuICAgICAgICAgICAgLy8g6L+Z6YeM5pS55oiQ55u45a+55Zyw5Z2A55qE5qih5Z2XXHJcbiAgICAgICAgICAgIGxldCBuS2V5ID0ga2V5LnJlcGxhY2UoZmlsZVJvdXRlLCBcIi9cIik7XHJcbiAgICAgICAgICAgIGxldCBuID0gdGhpcy5nZXRNb2R1bGUobktleSlcclxuICAgICAgICAgICAgbi5yb3V0ZU1hcCA9IE9iamVjdC5hc3NpZ24obW1hcC5yb3V0ZU1hcCwgbi5yb3V0ZU1hcClcclxuICAgICAgICAgICAgaWYgKG1tYXAuYWZ0ZXJMaXN0KSBuLmFmdGVyTGlzdC5wdXNoKC4uLm1tYXAuYWZ0ZXJMaXN0KVxyXG4gICAgICAgICAgICBpZiAobW1hcC5iZWZvcmVMaXN0KSBuLmJlZm9yZUxpc3QucHVzaCguLi5tbWFwLmJlZm9yZUxpc3QpXHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnJvdXRlTWFwW2tleV1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tYWluUGF0aCA9IGZpbGVSb3V0ZTtcclxuICAgIH1cclxuXHJcbiAgICBoYXNNb2R1bGUocHJlUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucm91dGVNYXBbcHJlUGF0aF0pIHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZm9ybWF0ZVJvdXRlKHByZVBhdGg6IHN0cmluZykge1xyXG4gICAgICAgIHByZVBhdGggPSBwcmVQYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpXHJcbiAgICAgICAgaWYgKHRoaXMubWFpblBhdGgpIHtcclxuICAgICAgICAgICAgcHJlUGF0aCA9IHByZVBhdGgucmVwbGFjZSh0aGlzLm1haW5QYXRoLCBcIi9cIilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByZVBhdGggPSBwcmVQYXRoLnJlcGxhY2UoL1xcL1xcLy9nLCBcIi9cIilcclxuICAgICAgICBpZiAocHJlUGF0aCA9PSB1bmRlZmluZWQgfHwgcHJlUGF0aCA9PSBudWxsIHx8IHByZVBhdGggPT0gXCJcIikgcHJlUGF0aCA9IFwiL1wiO1xyXG4gICAgICAgIGlmIChwcmVQYXRoWzBdICE9IFwiL1wiKSBwcmVQYXRoID0gXCIvXCIgKyBwcmVQYXRoXHJcbiAgICAgICAgLy8gaWYgKHByZVBhdGguY2hhckF0KDApICE9IFwiL1wiKSBwcmVQYXRoID0gXCIvXCIgKyBwcmVQYXRoO1xyXG5cclxuICAgICAgICByZXR1cm4gcHJlUGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRNb2R1bGUocHJlUGF0aDogc3RyaW5nKSB7XHJcbiAgICAgICAgcHJlUGF0aCA9IHRoaXMuZm9ybWF0ZVJvdXRlKHByZVBhdGgpXHJcblxyXG4gICAgICAgIGlmICghdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSkgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSA9IG5ldyBIYW5kbGVVbml0KClcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NoZWNoTWV0aG9kKHRhcmdldDogYW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJOb2RlKSB0aGlzLmN1cnJOb2RlID0gbmV3IEhhbmRsZVVuaXQoKVxyXG4gICAgICAgIGlmICghdGFyZ2V0Ll9fX3N5bWJvbCkgdGFyZ2V0Ll9fX3N5bWJvbCA9IHRoaXMuY3Vyck5vZGUuc3ltYm9sO1xyXG4gICAgICAgIGlmICh0YXJnZXQuX19fc3ltYm9sICE9IHRoaXMuY3Vyck5vZGUuc3ltYm9sKSB7XHJcbiAgICAgICAgICAgIC8vIOihqOekuuazqOWGjOeahOS4jeaYr+W9k+WJjWNsYXNz55qE5qih5Z2X5LqG77yM6ZyA6KaB5pu/5o2iXHJcbiAgICAgICAgICAgIHRoaXMuY3Vyck5vZGUgPSBuZXcgSGFuZGxlVW5pdFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruaooeWdl+eahOW9kuWxnlxyXG4gICAgICovXHJcbiAgICBjbGFzcyhwcmVQYXRoPzogc3RyaW5nIHwgTm9kZU1vZHVsZSk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocHJlUGF0aCA9PSB1bmRlZmluZWQpIHByZVBhdGggPSB0YXJnZXQubmFtZVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHByZVBhdGggIT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBkID0gcGFyc2UocHJlUGF0aC5maWxlbmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGQubmFtZSA9PSBcImluZGV4XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmVQYXRoID0gcGQuZGlyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlUGF0aCA9IGpvaW4ocGQuZGlyLCBwZC5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwcmVQYXRoID0gdGhpcy5mb3JtYXRlUm91dGUocHJlUGF0aCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY3Vyck5vZGUpIHJldHVybjtcclxuICAgICAgICAgICAgLy8g6L+Z6YeM6LSf6LSj5oqK5b2T5YmN5rOo5YaM55qE6IqC54K55re75Yqg5Yiw55uu5qCH6IqC54K55bqT5LitXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvdXRlTWFwW3ByZVBhdGhdKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDov5nph4zpnIDopoHlkIjlubZcclxuICAgICAgICAgICAgICAgIHRoaXMucm91dGVNYXBbcHJlUGF0aF0ucm91dGVNYXAgPSBPYmplY3QuYXNzaWduKHRoaXMucm91dGVNYXBbcHJlUGF0aF0ucm91dGVNYXAsIHRoaXMuY3Vyck5vZGUucm91dGVNYXApXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZS5hZnRlckxpc3QpIHRoaXMucm91dGVNYXBbcHJlUGF0aF0uYWZ0ZXJMaXN0LnB1c2goLi4udGhpcy5jdXJyTm9kZS5hZnRlckxpc3QpXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0KSB0aGlzLnJvdXRlTWFwW3ByZVBhdGhdLmJlZm9yZUxpc3QucHVzaCguLi50aGlzLmN1cnJOb2RlLmJlZm9yZUxpc3QpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJOb2RlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yb3V0ZU1hcFtwcmVQYXRoXSA9IHRoaXMuY3Vyck5vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJOb2RlID0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvckV4PGFueT4pIHtcclxuICAgICAgICBpZiAoIWRlc2NyaXB0b3IucGFyYW1zKSBkZXNjcmlwdG9yLnBhcmFtcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDms6jlhozot6/nlLFcclxuICAgICovXHJcbiAgICByb3V0ZShOYW1lPzogc3RyaW5nKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCwgbmFtZSwgZGVzY3JpcHRvcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGVjaE1ldGhvZCh0YXJnZXQpXHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yKVxyXG4gICAgICAgICAgICBpZiAoTmFtZSA9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG5hbWUgPT0gXCJzdHJpbmdcIikgTmFtZSA9IG5hbWU7XHJcbiAgICAgICAgICAgIGlmIChOYW1lID09IHVuZGVmaW5lZCB8fCBkZXNjcmlwdG9yLnZhbHVlID09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jdXJyTm9kZSkgdGhpcy5jdXJyTm9kZS5yb3V0ZU1hcFtOYW1lXSA9IHtcclxuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWUgYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiAoZGVzY3JpcHRvciBhcyBhbnkpLnBhcmFtc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDmo4Dmn6Xot6/nlLHlj4LmlbAg5aaC5p6c6LCD55So5LqG6YKj5LmI5bCx57uZ6L+Z5Liq5Ye95pWw5aKe5Yqg5LiA5Liq5Y+C5pWw5qOA5p+l55qE5qCH6K+G77yM5ZCm5YiZ5bCx5LiN5aSE55CGXHJcbiAgICAqL1xyXG4gICAgcGFyYW1zKHBOYW1lOiBzdHJpbmcsIHBUeXBlOiBTZVBhcmFtQ29uZmlnVHlwZSwgcmVxdWlyZWQ6IGJvb2xlYW4sIGNoYW5nZTogYm9vbGVhbik6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuICh0YXJnZXQsIG5hbWUsIGRlc2NyaXB0b3I6IFR5cGVkUHJvcGVydHlEZXNjcmlwdG9yRXg8YW55PikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm1ldGhvZFByZXBhcmUoZGVzY3JpcHRvcilcclxuICAgICAgICAgICAgdGhpcy5fY2hlY2hNZXRob2QodGFyZ2V0KVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY3Vyck5vZGUgfHwgIWRlc2NyaXB0b3IucGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnkIborrrkuIrkuI3kvJrov5vlhaXov5nph4znmoRcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRvci5wYXJhbXNbcE5hbWVdID0geyB0eXBlOiBwVHlwZSwgcmVxdWlyZWQ6IHJlcXVpcmVkLCBjaGFuZ2U6IGNoYW5nZSB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDov5nph4zlpoLmnpzkvKDlhaXnmoTmmK8gc3ltYm9sIOmCo+S5iOWwseavlOi+g+mavuWPl+S6hlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBwYXJhbXMgY2hlY2sgZXJyb3Igb24gZnVuYyAke25hbWUudG9TdHJpbmcoKX0gJHtwTmFtZX0gJHtwVHlwZX1gKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5YmN55qE6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5YmN572u5YeG5aSHXHJcbiAgICAgKi9cclxuICAgIGJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiAodGFyZ2V0LCBuYW1lLCBkZXNjcmlwdG9yOiBUeXBlZFByb3BlcnR5RGVzY3JpcHRvckV4PGFueT4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5tZXRob2RQcmVwYXJlKGRlc2NyaXB0b3IpXHJcbiAgICAgICAgICAgIHRoaXMuX2NoZWNoTWV0aG9kKHRhcmdldClcclxuICAgICAgICAgICAgaWYgKGRlc2NyaXB0b3IudmFsdWUgJiYgdGhpcy5jdXJyTm9kZSkgdGhpcy5jdXJyTm9kZS5iZWZvcmVMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGRlc2NyaXB0b3IucGFyYW1zIHx8IHt9LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgYWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gKHRhcmdldCwgbmFtZSwgZGVzY3JpcHRvcjogVHlwZWRQcm9wZXJ0eURlc2NyaXB0b3JFeDxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubWV0aG9kUHJlcGFyZShkZXNjcmlwdG9yKVxyXG4gICAgICAgICAgICB0aGlzLl9jaGVjaE1ldGhvZCh0YXJnZXQpXHJcbiAgICAgICAgICAgIGlmIChkZXNjcmlwdG9yLnZhbHVlICYmIHRoaXMuY3Vyck5vZGUpIHRoaXMuY3Vyck5vZGUuYWZ0ZXJMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGRlc2NyaXB0b3IucGFyYW1zIHx8IHt9LFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGRlc2NyaXB0b3IudmFsdWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXZWJIYW5kbGUge1xyXG4gICAgbWFpblBhdGggPSBcIlwiXHJcbiAgICBpbml0KG1haW5QYXRoOiBzdHJpbmcsIGVudj86ICgoKSA9PiBzdHJpbmcpIHwgc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5tYWluUGF0aCA9IG1haW5QYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpXHJcbiAgICAgICAgdGhpcy5zZXRFbnYoZW52IHx8IFwiXCIpXHJcblxyXG4gICAgICAgIC8vIOWQiOW5tuS4gOS4i+WViuWQhOenjeaooeWdl1xyXG4gICAgICAgIHRoaXMucm91dGVNYXAubWVyZ2VNb2R1bGUodGhpcy5tYWluUGF0aClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdsb2JhbE1hcCA9IG5ldyBIYW5kbGVNYXAoXCJnbG9iYWxcIilcclxuICAgIHByaXZhdGUgZW52TWFwID0gbmV3IEhhbmRsZU1hcChcImVudlwiKVxyXG4gICAgcHJpdmF0ZSByb3V0ZU1hcCA9IG5ldyBIYW5kbGVNYXAoXCJyb3V0ZVwiKVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiDorr7nva7mqKHlnZfnmoTlvZLlsZ5cclxuICAgICovXHJcbiAgICBjbGFzcyhwcmVQYXRoPzogc3RyaW5nIHwgTm9kZU1vZHVsZSk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5jbGFzcyhwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM6Lev55SxXHJcbiAgICAgKi9cclxuICAgIHJvdXRlKE5hbWU/OiBzdHJpbmcpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlTWFwLnJvdXRlKE5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rOo5YaM5Y+C5pWw5qOA5p+lXHJcbiAgICAgKi9cclxuICAgIHBhcmFtcyhOYW1lOiBzdHJpbmcsIHR5cGU6IFNlUGFyYW1Db25maWdUeXBlLCByZXF1aXJlZDogYm9vbGVhbiwgY2hhbmdlOiBib29sZWFuKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5wYXJhbXMoTmFtZSwgdHlwZSwgcmVxdWlyZWQsIGNoYW5nZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjliY3nmoTosIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvliY3nva7lh4blpIdcclxuICAgICAqL1xyXG4gICAgYmVmb3JlKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucm91dGVNYXAuYmVmb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgYWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yb3V0ZU1hcC5hZnRlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5LiA5Liq5ZON5bqU5qih5Z2XXHJcbiAgICAgKiBAcGFyYW0gcHJlUGF0aCDlj6/ku6Xorr7nva7nm7jlr7not6/lvoTlrZfnrKbkuLLvvIzmiJbogIXmqKHlnZflr7nosaFcclxuICAgICAqL1xyXG4gICAgZ2V0TW9kdWxlKHByZVBhdGg6IHN0cmluZyB8IE5vZGVNb2R1bGUpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHByZVBhdGggIT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBwcmVQYXRoID0gcHJlUGF0aC5maWxlbmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlTWFwLmdldE1vZHVsZShwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIGdldEVudk1vZHVsZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbnZNYXAuZ2V0TW9kdWxlKHRoaXMuZ2V0RW52KCkpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0R2xvYmFsTW9kdWxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdsb2JhbE1hcC5nZXRNb2R1bGUoXCJcIilcclxuICAgIH1cclxuXHJcbiAgICAvLyDlvZPliY3nmoTnjq/looNcclxuICAgIHByaXZhdGUgX2VudjogKCgpID0+IHN0cmluZykgfCBzdHJpbmcgPSBcIlwiXHJcbiAgICAvKipcclxuICAgICAqIOiuvue9ruW9k+WJjeeOr+WigyDvvIjkuLvopoHmmK/mj5Dkvpvnu5nlpITnkIbmlrnms5XosIPnlKjnjq/looPliKTmlq3vvIlcclxuICAgICAqIEBwYXJhbSBlbnYg546v5aKD5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHNldEVudihlbnY6ICgoKSA9PiBzdHJpbmcpIHwgc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5fZW52ID0gZW52XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5blvZPliY3njq/looNcclxuICAgICAqL1xyXG4gICAgZ2V0RW52KCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5fZW52ID09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZW52KClcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbnY7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6K6+572u5qih5Z2X55qE5b2S5bGeXHJcbiAgICAgKi9cclxuICAgIGVudkNsYXNzKHByZVBhdGg/OiBzdHJpbmcgfCBOb2RlTW9kdWxlKTogQ2xhc3NEZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5jbGFzcyhwcmVQYXRoKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qih5Z2X5pa55rOV6LCD55So5YmN55qE6LCD55So77yM5Li76KaB5piv57uZ5pWw5o2u5aSE55CG5o+Q5L6b5YmN572u5YeG5aSHXHJcbiAgICAgKi9cclxuICAgIGVudkJlZm9yZSgpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5iZWZvcmUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaooeWdl+aWueazleiwg+eUqOWQjuiwg+eUqO+8jOS4u+imgeaYr+e7meaVsOaNruWkhOeQhuaPkOS+m+acgOWQjueahOaTjeS9nFxyXG4gICAgICovXHJcbiAgICBlbnZBZnRlcigpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudk1hcC5hZnRlcigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YWo5bGA5qih5Z2XXHJcbiAgICAgKi9cclxuICAgIGdsb2JhbENsYXNzKCk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuY2xhc3MoXCJcIilcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaooeWdl+aWueazleiwg+eUqOWJjeeahOiwg+eUqO+8jOS4u+imgeaYr+e7meaVsOaNruWkhOeQhuaPkOS+m+WJjee9ruWHhuWkh1xyXG4gICAgICovXHJcbiAgICBnbG9iYWxCZWZvcmUoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuYmVmb3JlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgZ2xvYmFsQWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxNYXAuYWZ0ZXIoKTtcclxuICAgIH1cclxufSJdfQ==