"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebRouteModule = void 0;
var webHandle_1 = require("./webHandle");
Object.defineProperty(exports, "WebHandle", { enumerable: true, get: function () { return webHandle_1.WebHandle; } });
var HttpQuest_1 = require("./HttpQuest");
Object.defineProperty(exports, "http_quest", { enumerable: true, get: function () { return HttpQuest_1.http_quest; } });
const server_1 = require("./server");
const path_1 = require("path");
const commonRoute_1 = require("./commonRoute");
const webHandle_2 = require("./webHandle");
const loadWebFiles_1 = require("./loadWebFiles");
const ip_1 = require("./ip");
var instance = new server_1.WebRouteUnit();
var webHandle = new webHandle_2.WebHandle();
/**
 * 这里负责http的解析，然后传递给对于的处理方法
 * 目前比较简陋，后续需要增加一下处理
 *
 * envBefore -> globalBefore -> before -> route -> after -> globalAfter -> envAfter
 *
 */
exports.WebRouteModule = {
    name: 'WebRouteModule',
    /**
     * 是否开启跨域
     */
    openCross() {
        instance.enable("cross");
    },
    // 获取资源实例
    getApp() {
        return instance.app;
    },
    // 开始静态资源目录
    static(pre, root) {
        return instance.static(pre, root);
    },
    setproxy(ips) {
        return instance.app.set("trust proxy", ips);
    },
    /**
     * 初始化模块
     * @param port
     */
    init(port, webPath, env, limit) {
        return __awaiter(this, void 0, void 0, function* () {
            // 先初始化模块
            webHandle.init(webPath, env);
            // 这里需要增加一个拉起所有的模块文件的功能
            yield instance.init(port, [commonRoute_1.start.bind(webHandle)], limit);
            loadWebFiles_1.loadModule(webPath);
            return true;
        });
    },
    ////////////////////////////////////////////////////////////////
    /**
    * 注册模块
    * @param prePath 模块的前缀词 例如 /a/b 的前缀就是 /a 或者/a/
    */
    class(prePath) {
        return webHandle.class(prePath);
    },
    /**
    * 注册路由
    * @param Name 后缀词 例如 /a/b 的后缀就是 b 或者/b
    */
    route(Name) {
        return webHandle.route(Name);
    },
    /**
    * 检查参数
    * @param name 参数名字
    * @param sType 参数类型
    * @param [change] 是否强制转换类型
    */
    paramRequired(name, sType, change) {
        return webHandle.params(name, sType, true, change);
    },
    /**
   * 检查参数
   * @param name 参数名字
   * @param sType 参数类型
   * @param [change] 是否强制转换类型
   */
    paramOptional(name, sType, change) {
        return webHandle.params(name, sType, false, change);
    },
    /**
     * 模块方法调用前的调用，主要是给数据处理提供前置准备
     */
    before() {
        return webHandle.before();
    },
    /**
     * 模块方法调用后调用，主要是给数据处理提供最后的操作
     */
    after() {
        return webHandle.after();
    },
    /////////////////////////////////////////////////
    /**
     * 注册环境处理模块
     * @param evnName 环境名字
     */
    envClass(evnName) {
        return webHandle.envClass(evnName);
    },
    /**
     * 对应环境下先调用
     */
    envBefore() {
        return webHandle.envBefore();
    },
    /**
     * 对应环境下处理后调用
     */
    envAfter() {
        return webHandle.envAfter();
    },
    /**
     * 注册环境处理模块
     * @param evnName 环境名字
     */
    globalClass() {
        return webHandle.globalClass();
    },
    /**
    *
    */
    globalBefore() {
        return webHandle.globalBefore();
    },
    /**
     *
     */
    globalAfter() {
        return webHandle.globalAfter();
    },
    //////////////////////////////////////////////////////////////
    /**
     * @description 开启Swagger模块
     * @date 2020-01-16
     * @param {{ basedir: string; routePath: string; description?: string; title?: string; version?: string; host?: string; basePath?: string; produces?: string[]; schemes?: string[]; }} { basedir, jsPath, description = 'This is a sample server', title = 'Swagger', version = '1.0.0', host = 'localhost', basePath = '', produces = [
     *             "application/json"
     *         ], schemes = ['http'] }
     */
    openSwagger({ basedir, host, routePath, basePath = '', ext = ".js", description = 'http api server', title = 'dreamduke', version = '1.0.0', produces = [
        "application/json"
    ], schemes = ['http'] }) {
        let option = {
            swaggerDefinition: {
                info: {
                    description: description,
                    title: title,
                    version: version
                },
                host: host || ip_1.IPFindOne("IPv4"),
                basePath: basePath,
                produces: produces,
                schemes: schemes,
                securityDefinitions: {
                    JWT: {
                        type: 'apiKey',
                        in: 'header',
                        name: 'Authorization',
                        description: "",
                    }
                }
            },
            route: {
                url: '/swagger',
                docs: '/swagger.json',
            },
            basedir: basedir || process.cwd(),
            files: [path_1.join(routePath || './web', '/**/*' + (ext || ".js"))] //Path to the API handle folder
        };
        try {
            const expressSwagger = require('express-swagger-generator')(instance.app);
            expressSwagger(option);
        }
        catch (e) {
            if (e && (e instanceof Error)) {
                console.log('open openSwagger need install node_module : npm install ' + (e.message.match(/\'.*\'/) || []).join(' ').replace(/\'/g, ''));
            }
        }
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFDQSx5Q0FBMkQ7QUFBbEQsc0dBQUEsU0FBUyxPQUFBO0FBQ2xCLHlDQUF5QztBQUFoQyx1R0FBQSxVQUFVLE9BQUE7QUFDbkIscUNBQXdDO0FBQ3hDLCtCQUE0QjtBQUM1QiwrQ0FBc0M7QUFDdEMsMkNBQTJEO0FBQzNELGlEQUE0QztBQUM1Qyw2QkFBaUM7QUFFakMsSUFBSSxRQUFRLEdBQWlCLElBQUkscUJBQVksRUFBRSxDQUFDO0FBQ2hELElBQUksU0FBUyxHQUFjLElBQUkscUJBQVMsRUFBRSxDQUFDO0FBZ0IzQzs7Ozs7O0dBTUc7QUFDUSxRQUFBLGNBQWMsR0FBRztJQUN4QixJQUFJLEVBQUUsZ0JBQWdCO0lBQ3RCOztPQUVHO0lBQ0gsU0FBUztRQUNMLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUNELFNBQVM7SUFDVCxNQUFNO1FBQ0YsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDO0lBQ3hCLENBQUM7SUFDRCxXQUFXO0lBQ1gsTUFBTSxDQUFDLEdBQVcsRUFBRSxJQUFZO1FBQzVCLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDckMsQ0FBQztJQUNELFFBQVEsQ0FBQyxHQUFXO1FBQ2hCLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQy9DLENBQUM7SUFDRDs7O09BR0c7SUFDRyxJQUFJLENBQUMsSUFBWSxFQUFFLE9BQWUsRUFBRSxHQUE2QixFQUFFLEtBQTRNOztZQUNqUixTQUFTO1lBQ1QsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUE7WUFDNUIsdUJBQXVCO1lBQ3ZCLE1BQU0sUUFBUSxDQUFDLElBQUks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Q2xCO2lCQUNKO2FBQ0o7WUFDRCxLQUFLLEVBQUU7Z0JBQ0gsR0FBRyxFQUFFLFVBQVU7Z0JBQ2YsSUFBSSxFQUFFLGVBQWU7YUFDeEI7WUFDRCxPQUFPLEVBQUUsT0FBTyxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDakMsS0FBSyxFQUFFLENBQUMsV0FBSSxDQUFDLFNBQVMsSUFBSSxPQUFPLEVBQUUsT0FBTyxHQUFHLENBQUMsR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQywrQkFBK0I7U0FDaEcsQ0FBQTtRQUVELElBQUk7WUFDQSxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1NBQ3pCO1FBQ0QsT0FBTyxDQUFDLEVBQUU7WUFDTixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxLQUFLLENBQUMsRUFBRTtnQkFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQywwREFBMEQsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7YUFDM0k7U0FDSjtJQUNMLENBQUM7Q0FDSixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UsIE5leHRGdW5jdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xyXG5leHBvcnQgeyBXZWJIYW5kbGUsIFNlUGFyYW1Db25maWdUeXBlIH0gZnJvbSBcIi4vd2ViSGFuZGxlXCI7XHJcbmV4cG9ydCB7IGh0dHBfcXVlc3QgfSBmcm9tIFwiLi9IdHRwUXVlc3RcIjtcclxuaW1wb3J0IHsgV2ViUm91dGVVbml0IH0gZnJvbSBcIi4vc2VydmVyXCI7XHJcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgc3RhcnQgfSBmcm9tIFwiLi9jb21tb25Sb3V0ZVwiO1xyXG5pbXBvcnQgeyBXZWJIYW5kbGUsIFNlUGFyYW1Db25maWdUeXBlIH0gZnJvbSAnLi93ZWJIYW5kbGUnO1xyXG5pbXBvcnQgeyBsb2FkTW9kdWxlIH0gZnJvbSAnLi9sb2FkV2ViRmlsZXMnO1xyXG5pbXBvcnQgeyBJUEZpbmRPbmUgfSBmcm9tICcuL2lwJztcclxuXHJcbnZhciBpbnN0YW5jZTogV2ViUm91dGVVbml0ID0gbmV3IFdlYlJvdXRlVW5pdCgpO1xyXG52YXIgd2ViSGFuZGxlOiBXZWJIYW5kbGUgPSBuZXcgV2ViSGFuZGxlKCk7XHJcblxyXG5cclxuaW50ZXJmYWNlIFN3YWdnZXJPcHRpb25zIHtcclxuICAgIHJvdXRlUGF0aDogc3RyaW5nO1xyXG4gICAgYmFzZWRpcjogc3RyaW5nO1xyXG4gICAgZXh0Pzogc3RyaW5nLFxyXG4gICAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XHJcbiAgICB0aXRsZT86IHN0cmluZztcclxuICAgIHZlcnNpb24/OiBzdHJpbmc7XHJcbiAgICBob3N0Pzogc3RyaW5nO1xyXG4gICAgYmFzZVBhdGg/OiBzdHJpbmc7XHJcbiAgICBwcm9kdWNlcz86IHN0cmluZ1tdO1xyXG4gICAgc2NoZW1lcz86IHN0cmluZ1tdO1xyXG59XHJcblxyXG4vKipcclxuICog6L+Z6YeM6LSf6LSjaHR0cOeahOino+aekO+8jOeEtuWQjuS8oOmAkue7meWvueS6jueahOWkhOeQhuaWueazlSBcclxuICog55uu5YmN5q+U6L6D566A6ZmL77yM5ZCO57ut6ZyA6KaB5aKe5Yqg5LiA5LiL5aSE55CGXHJcbiAqIFxyXG4gKiBlbnZCZWZvcmUgLT4gZ2xvYmFsQmVmb3JlIC0+IGJlZm9yZSAtPiByb3V0ZSAtPiBhZnRlciAtPiBnbG9iYWxBZnRlciAtPiBlbnZBZnRlclxyXG4gKiBcclxuICovXHJcbmV4cG9ydCB2YXIgV2ViUm91dGVNb2R1bGUgPSB7XHJcbiAgICBuYW1lOiAnV2ViUm91dGVNb2R1bGUnLFxyXG4gICAgLyoqXHJcbiAgICAgKiDmmK/lkKblvIDlkK/ot6jln59cclxuICAgICAqL1xyXG4gICAgb3BlbkNyb3NzKCkge1xyXG4gICAgICAgIGluc3RhbmNlLmVuYWJsZShcImNyb3NzXCIpXHJcbiAgICB9LFxyXG4gICAgLy8g6I635Y+W6LWE5rqQ5a6e5L6LXHJcbiAgICBnZXRBcHAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLmFwcDtcclxuICAgIH0sXHJcbiAgICAvLyDlvIDlp4vpnZnmgIHotYTmupDnm67lvZVcclxuICAgIHN0YXRpYyhwcmU6IHN0cmluZywgcm9vdDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnN0YXRpYyhwcmUsIHJvb3QpXHJcbiAgICB9LFxyXG4gICAgc2V0cHJveHkoaXBzOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gaW5zdGFuY2UuYXBwLnNldChcInRydXN0IHByb3h5XCIsIGlwcylcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIOWIneWni+WMluaooeWdl1xyXG4gICAgICogQHBhcmFtIHBvcnQgXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGluaXQocG9ydDogbnVtYmVyLCB3ZWJQYXRoOiBzdHJpbmcsIGVudj86IHN0cmluZyB8ICgoKSA9PiBzdHJpbmcpLCBsaW1pdD86IHN0cmluZyB8IHsgW3g6IHN0cmluZ106IHN0cmluZyB8IGJvb2xlYW4gfCB1bmRlZmluZWQ7IGd6aXA/OiBib29sZWFuOyBqc29uPzogc3RyaW5nIHwgdW5kZWZpbmVkOyB0ZXh0Pzogc3RyaW5nIHwgdW5kZWZpbmVkOyByYXc/OiBzdHJpbmcgfCB1bmRlZmluZWQ7IHVybGVuY29kZWQ/OiBzdHJpbmcgfCB1bmRlZmluZWQ7IH0gfCB1bmRlZmluZWQpIHtcclxuICAgICAgICAvLyDlhYjliJ3lp4vljJbmqKHlnZdcclxuICAgICAgICB3ZWJIYW5kbGUuaW5pdCh3ZWJQYXRoLCBlbnYpXHJcbiAgICAgICAgLy8g6L+Z6YeM6ZyA6KaB5aKe5Yqg5LiA5Liq5ouJ6LW35omA5pyJ55qE5qih5Z2X5paH5Lu255qE5Yqf6IO9XHJcbiAgICAgICAgYXdhaXQgaW5zdGFuY2UuaW5pdChwb3J0LCBbc3RhcnQuYmluZCh3ZWJIYW5kbGUpXSwgbGltaXQpXHJcbiAgICAgICAgbG9hZE1vZHVsZSh3ZWJQYXRoKVxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICB9LFxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLyoqXHJcbiAgICAqIOazqOWGjOaooeWdl1xyXG4gICAgKiBAcGFyYW0gcHJlUGF0aCDmqKHlnZfnmoTliY3nvIDor40g5L6L5aaCIC9hL2Ig55qE5YmN57yA5bCx5pivIC9hIOaIluiAhS9hL1xyXG4gICAgKi9cclxuICAgIGNsYXNzKHByZVBhdGg/OiBzdHJpbmcgfCBOb2RlTW9kdWxlKTogQ2xhc3NEZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuY2xhc3MocHJlUGF0aClcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAqIOazqOWGjOi3r+eUsVxyXG4gICAgKiBAcGFyYW0gTmFtZSDlkI7nvIDor40g5L6L5aaCIC9hL2Ig55qE5ZCO57yA5bCx5pivIGIg5oiW6ICFL2JcclxuICAgICovXHJcbiAgICByb3V0ZShOYW1lPzogc3RyaW5nKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLnJvdXRlKE5hbWUpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICog5qOA5p+l5Y+C5pWwXHJcbiAgICAqIEBwYXJhbSBuYW1lIOWPguaVsOWQjeWtl1xyXG4gICAgKiBAcGFyYW0gc1R5cGUg5Y+C5pWw57G75Z6LXHJcbiAgICAqIEBwYXJhbSBbY2hhbmdlXSDmmK/lkKblvLrliLbovazmjaLnsbvlnosgXHJcbiAgICAqL1xyXG4gICAgcGFyYW1SZXF1aXJlZChuYW1lOiBzdHJpbmcsIHNUeXBlOiBTZVBhcmFtQ29uZmlnVHlwZSwgY2hhbmdlOiBib29sZWFuKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLnBhcmFtcyhuYW1lLCBzVHlwZSwgdHJ1ZSwgY2hhbmdlKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICog5qOA5p+l5Y+C5pWwXHJcbiAgICogQHBhcmFtIG5hbWUg5Y+C5pWw5ZCN5a2XXHJcbiAgICogQHBhcmFtIHNUeXBlIOWPguaVsOexu+Wei1xyXG4gICAqIEBwYXJhbSBbY2hhbmdlXSDmmK/lkKblvLrliLbovazmjaLnsbvlnosgXHJcbiAgICovXHJcbiAgICBwYXJhbU9wdGlvbmFsKG5hbWU6IHN0cmluZywgc1R5cGU6IFNlUGFyYW1Db25maWdUeXBlLCBjaGFuZ2U6IGJvb2xlYW4pOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUucGFyYW1zKG5hbWUsIHNUeXBlLCBmYWxzZSwgY2hhbmdlKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjliY3nmoTosIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvliY3nva7lh4blpIdcclxuICAgICAqL1xyXG4gICAgYmVmb3JlKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5iZWZvcmUoKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmqKHlnZfmlrnms5XosIPnlKjlkI7osIPnlKjvvIzkuLvopoHmmK/nu5nmlbDmja7lpITnkIbmj5DkvpvmnIDlkI7nmoTmk43kvZxcclxuICAgICAqL1xyXG4gICAgYWZ0ZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmFmdGVyKCk7XHJcbiAgICB9LFxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLyoqXHJcbiAgICAgKiDms6jlhoznjq/looPlpITnkIbmqKHlnZdcclxuICAgICAqIEBwYXJhbSBldm5OYW1lIOeOr+Wig+WQjeWtl1xyXG4gICAgICovXHJcbiAgICBlbnZDbGFzcyhldm5OYW1lPzogc3RyaW5nKTogQ2xhc3NEZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuZW52Q2xhc3MoZXZuTmFtZSlcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlr7nlupTnjq/looPkuIvlhYjosIPnlKhcclxuICAgICAqL1xyXG4gICAgZW52QmVmb3JlKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5lbnZCZWZvcmUoKTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIOWvueW6lOeOr+Wig+S4i+WkhOeQhuWQjuiwg+eUqFxyXG4gICAgICovXHJcbiAgICBlbnZBZnRlcigpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuZW52QWZ0ZXIoKTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIOazqOWGjOeOr+Wig+WkhOeQhuaooeWdl1xyXG4gICAgICogQHBhcmFtIGV2bk5hbWUg546v5aKD5ZCN5a2XXHJcbiAgICAgKi9cclxuICAgIGdsb2JhbENsYXNzKCk6IENsYXNzRGVjb3JhdG9yIHtcclxuICAgICAgICByZXR1cm4gd2ViSGFuZGxlLmdsb2JhbENsYXNzKClcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICogXHJcbiAgICAqL1xyXG4gICAgZ2xvYmFsQmVmb3JlKCk6IE1ldGhvZERlY29yYXRvciB7XHJcbiAgICAgICAgcmV0dXJuIHdlYkhhbmRsZS5nbG9iYWxCZWZvcmUoKTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIFxyXG4gICAgICovXHJcbiAgICBnbG9iYWxBZnRlcigpOiBNZXRob2REZWNvcmF0b3Ige1xyXG4gICAgICAgIHJldHVybiB3ZWJIYW5kbGUuZ2xvYmFsQWZ0ZXIoKTtcclxuICAgIH0sXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzY3JpcHRpb24g5byA5ZCvU3dhZ2dlcuaooeWdl1xyXG4gICAgICogQGRhdGUgMjAyMC0wMS0xNlxyXG4gICAgICogQHBhcmFtIHt7IGJhc2VkaXI6IHN0cmluZzsgcm91dGVQYXRoOiBzdHJpbmc7IGRlc2NyaXB0aW9uPzogc3RyaW5nOyB0aXRsZT86IHN0cmluZzsgdmVyc2lvbj86IHN0cmluZzsgaG9zdD86IHN0cmluZzsgYmFzZVBhdGg/OiBzdHJpbmc7IHByb2R1Y2VzPzogc3RyaW5nW107IHNjaGVtZXM/OiBzdHJpbmdbXTsgfX0geyBiYXNlZGlyLCBqc1BhdGgsIGRlc2NyaXB0aW9uID0gJ1RoaXMgaXMgYSBzYW1wbGUgc2VydmVyJywgdGl0bGUgPSAnU3dhZ2dlcicsIHZlcnNpb24gPSAnMS4wLjAnLCBob3N0ID0gJ2xvY2FsaG9zdCcsIGJhc2VQYXRoID0gJycsIHByb2R1Y2VzID0gW1xyXG4gICAgICogICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICAgICAqICAgICAgICAgXSwgc2NoZW1lcyA9IFsnaHR0cCddIH1cclxuICAgICAqL1xyXG4gICAgb3BlblN3YWdnZXIoXHJcbiAgICAgICAgeyBiYXNlZGlyLFxyXG4gICAgICAgICAgICBob3N0LFxyXG4gICAgICAgICAgICByb3V0ZVBhdGgsXHJcbiAgICAgICAgICAgIGJhc2VQYXRoID0gJycsXHJcbiAgICAgICAgICAgIGV4dCA9IFwiLmpzXCIsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ2h0dHAgYXBpIHNlcnZlcicsXHJcbiAgICAgICAgICAgIHRpdGxlID0gJ2RyZWFtZHVrZScsXHJcbiAgICAgICAgICAgIHZlcnNpb24gPSAnMS4wLjAnLFxyXG4gICAgICAgICAgICBwcm9kdWNlcyA9IFtcclxuICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgICAgICAgICAgIF0sIHNjaGVtZXMgPSBbJ2h0dHAnXSB9OiBTd2FnZ2VyT3B0aW9ucyxcclxuICAgICkge1xyXG4gICAgICAgIGxldCBvcHRpb24gPSB7XHJcbiAgICAgICAgICAgIHN3YWdnZXJEZWZpbml0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICBpbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaG9zdDogaG9zdCB8fCBJUEZpbmRPbmUoXCJJUHY0XCIpLFxyXG4gICAgICAgICAgICAgICAgYmFzZVBhdGg6IGJhc2VQYXRoLFxyXG4gICAgICAgICAgICAgICAgcHJvZHVjZXM6IHByb2R1Y2VzLFxyXG4gICAgICAgICAgICAgICAgc2NoZW1lczogc2NoZW1lcyxcclxuICAgICAgICAgICAgICAgIHNlY3VyaXR5RGVmaW5pdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBKV1Q6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2FwaUtleScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluOiAnaGVhZGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0F1dGhvcml6YXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJvdXRlOiB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvc3dhZ2dlcicsXHJcbiAgICAgICAgICAgICAgICBkb2NzOiAnL3N3YWdnZXIuanNvbicsICAgIC8vc3dhZ2dlcuaWh+S7tiBhcGlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYmFzZWRpcjogYmFzZWRpciB8fCBwcm9jZXNzLmN3ZCgpLCAvL2FwcCBhYnNvbHV0ZSBwYXRoXHJcbiAgICAgICAgICAgIGZpbGVzOiBbam9pbihyb3V0ZVBhdGggfHwgJy4vd2ViJywgJy8qKi8qJyArIChleHQgfHwgXCIuanNcIikpXSAvL1BhdGggdG8gdGhlIEFQSSBoYW5kbGUgZm9sZGVyXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBleHByZXNzU3dhZ2dlciA9IHJlcXVpcmUoJ2V4cHJlc3Mtc3dhZ2dlci1nZW5lcmF0b3InKShpbnN0YW5jZS5hcHApO1xyXG4gICAgICAgICAgICBleHByZXNzU3dhZ2dlcihvcHRpb24pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIChlIGluc3RhbmNlb2YgRXJyb3IpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb3BlbiBvcGVuU3dhZ2dlciBuZWVkIGluc3RhbGwgbm9kZV9tb2R1bGUgOiBucG0gaW5zdGFsbCAnICsgKGUubWVzc2FnZS5tYXRjaCgvXFwnLipcXCcvKSB8fCBbXSkuam9pbignICcpLnJlcGxhY2UoL1xcJy9nLCAnJykpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59XHJcbiJdfQ==