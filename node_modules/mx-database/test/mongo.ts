import { MongodbMoudle } from "../src"

MongodbMoudle.regist_colltion("test", "libtest", [])


describe("测试", function () {
    before(function () {
        this.timeout(5000)
        return MongodbMoudle.init([{ host: "10.0.0.10", port: 27017 }])
    })

    it("insert", function () {
        return MongodbMoudle.get_database("test").insert("libtest", { name: "nihao" })
    })

    it("list", function () {
        return new Promise(async function (r, j) {
            let vDB = await MongodbMoudle.get_database("test").get_unit("libtest", { name: "nihao" });
            vDB.load().then(v1 => {
                console.log("v1", Date.now());
            })

            vDB.load().then(v1 => {
                console.log("v2", Date.now());
            })

            vDB.load().then(v1 => {
                console.log("v3", Date.now());
            })

            r()
        })
    })

    it("unit", function () {
        return new Promise(function (r, j) {
            MongodbMoudle.get_database("test").get_unit("libtest", { name: "nihao" }).load().then(function (v) {
                console.log(JSON.stringify(v.data))
                r()
            }).catch(j)
        })
    })

    after(function (done) {
        setTimeout(function () {
            process.exit(0)
        })
        done()
    })
})